# 更新日志

## v3.1.0 - 用户体验优化：历史记录折叠与饮食数据增强

### 🎯 主要更新

#### 历史记录折叠/展开功能
- ✨ **锻炼记录折叠**
  - 默认只显示核心信息：日期、跑步时间、时长、距离
  - 点击左侧箭头图标展开详情：配速、力量训练、体感记录、删除按钮
  - 展开的行有高亮背景，视觉反馈清晰
  - 平滑的展开/折叠动画效果

- 📋 **饮食记录折叠**
  - 默认卡片折叠，只显示日期和星期
  - 点击卡片头部一键展开/折叠
  - 折叠图标旋转180度，交互反馈清晰
  - 内容区域带动画效果，体验流畅

#### 饮食记录数据增强
- 💧 **每日饮水记录**
  - 新增"饮水杯数"字段，记录每日饮水量
  - 带水滴图标显示，视觉效果友好
  - 在饮食卡片顶部显示，信息一目了然

- 🍰 **零食饮料备注**
  - 新增"零食与饮料"文本区域
  - 记录三餐之外的零食、饮料等
  - 带心形图标标识，突出显示
  - 支持搜索功能，快速查找相关记录

#### 界面优化
- 🎨 **视觉改进**
  - 折叠图标带平滑旋转动画
  - 展开的行/卡片有特殊背景色高亮
  - 详情内容采用卡片式布局，信息层次清晰
  - 统一的渐变背景和动画效果

- 📱 **交互优化**
  - 锻炼记录：点击折叠图标展开详情
  - 饮食记录：点击整个卡片头部展开/折叠
  - 删除按钮移到详情区域，避免误触
  - 搜索功能支持新增的零食字段

#### 技术改进
- 📝 新增代码约 230+ 行
  - index.html: +12 行（新增字段）
  - app.js: +100 行（折叠逻辑 + 新字段处理）
  - styles.css: +118 行（折叠样式 + 额外信息样式）
- 🔄 向后兼容：旧记录不包含新字段也能正常显示
- ✅ 所有代码通过语法检查
- 🎯 更简洁的历史记录浏览体验

#### 数据格式更新
**饮食记录新增字段**：
```json
{
  "date": "2025-10-23",
  "waterCups": 8,
  "snacks": "下午茶：一杯奶茶，几块饼干",
  "breakfast": {...},
  "lunch": {...},
  "dinner": {...}
}
```

---

## v3.0.0 - 日常记录系统：饮食模块 + 代码重构

### 🍽️ 饮食记录功能（重大新功能）

#### 核心功能
- ✨ 全新饮食记录模块，记录每日三餐
- 📝 完整的餐次记录：
  - 早餐、午餐、晚餐独立记录
  - 支持记录进餐时间、食物内容、备注
  - 灵活的表单设计，可选填任意餐次
- 🎨 精美的卡片式展示界面
  - 按日期分组，清晰展示每日饮食
  - 餐次图标标识（🌅 早餐、☀️ 午餐、🌙 晚餐）
  - 空餐次智能提示"未记录"
  - 深色/浅色模式完美适配
- 🔍 智能搜索功能
  - 支持按日期、食物、备注搜索
  - 实时过滤，即时响应
- 🗑️ 便捷的删除管理
  - 每日记录独立删除
  - 确认对话框防止误删

#### 数据存储
- 💾 独立的饮食数据文件（diet-data.json）
- 🔄 与运动数据分离管理，互不影响
- 📂 统一数据目录管理，便于备份

#### AI 助手增强
- 🤖 AI 支持饮食数据分析
- 🎯 新增数据类型选择：
  - 仅运动数据
  - 仅饮食数据
  - 全部数据（运动 + 饮食）
- 📊 提供完整饮食数据摘要给 AI
  - 按日期展示每日三餐
  - 包含时间、食物、备注信息
- 💡 智能建议：营养搭配、饮食改进、卡路里分析等

#### 用户界面
- 🎨 Record 页面分 Tab：运动记录 / 饮食记录
- 📋 History 页面分 Tab：运动历史 / 饮食历史
- 🔄 统一的交互体验，学习成本低
- ✨ 新增 300+ 行精美 CSS 样式

### 🔧 代码重构（可维护性大幅提升）

#### 主进程优化 (main.js)
- ♻️ 提取通用函数，消除重复代码
  - `handleSaveRecord()` - 统一保存记录逻辑
  - `handleDeleteRecord()` - 统一删除记录逻辑
  - `setDataDirectory()` - 集中配置管理
- 🎯 减少 60+ 行重复代码
- 🔧 支持多数据文件管理（exercise-data.json + diet-data.json）

#### 预加载层优化 (preload.js)
- 🚀 简化 IPC 方法暴露
  - 创建 `invoke()` 辅助函数（无参数调用）
  - 创建 `invokeWith()` 辅助函数（带参数调用）
- 📉 代码精简 44%（34 行 → 19 行）
- ✨ 统一调用模式，易于扩展

#### 渲染层优化 (app.js)
- 🎨 抽象表单提交逻辑
  - `submitFormWithFeedback()` - 通用表单处理器
  - 支持自定义数据获取、保存方法、成功消息
  - 统一的加载状态、错误处理、表单重置
- 🎯 统一样式切换
  - `setActiveClass()` - 一行代码完成 active 类切换
  - 应用于 7+ 处交互场景
- 📉 减少 90+ 行重复代码

#### 优化成果
- 📊 总体重复代码减少 **78%**（200 行 → 45 行）
- ✅ 所有修改通过语法检查
- 🎯 函数复用性：低 → 高
- 🛠️ 维护成本：高 → 低
- 📖 详细重构文档：REFACTORING_SUMMARY.md

### 🎯 其他改进

#### 系统升级
- 📝 系统改名为"日常记录系统"（覆盖运动 + 饮食）
- 🏷️ 侧边栏标题更新
- 📄 页面标题统一

#### 数据管理
- 📂 数据目录展示优化
  - 显示完整目录路径
  - Tooltip 提示包含的文件
- 🔄 切换数据目录时自动迁移两个数据文件
- 💾 配置文件新增 dataDirectory 字段

#### 技术改进
- 📦 新增代码约 1200+ 行
  - main.js: +60 行（新增饮食 IPC + 重构）
  - preload.js: -15 行（简化）
  - app.js: +450 行（饮食功能）
  - index.html: +250 行（饮食表单和展示）
  - styles.css: +380 行（饮食样式）
- ✅ 保持所有现有功能完整性
- 🚀 为未来扩展打下良好基础

---

## v2.1.1 - 代码优化

### 🔧 代码质量提升

#### 代码精简
- ♻️ 优化图表绘制函数，减少重复代码
  - 提取 `formatPaceTime` 通用函数，配速格式化更简洁
  - 创建 `createDataset` 辅助函数，力量训练图表代码减少 50%
  - 优化统计数据聚合逻辑，使用 `forEach` 替代重复赋值
- 🎨 深色模式样式优化
  - 合并重复的输入框样式定义（input/textarea/select/search-input）
  - 统一卡片背景样式（content-card/table-container/records-table）
  - 整合 AI 组件样式（ai-chat-input/ai-quick-btn/ai-retry-btn）
  - 删除重复的深色模式样式覆盖

#### 优化成果
- 📉 减少约 **82 行代码**
  - app.js: -31 行
  - styles.css: -51 行
- ✅ 保持所有功能完整性，无任何功能影响
- 📝 代码可读性更好，维护更容易
- 🚀 文件体积减小约 2.5KB

---

## v2.1.0

### 🚀 AI 功能重大升级

#### 流式输出
- ⚡ 实现 AI 回复流式输出，逐字显示效果更流畅
- ✨ 美化等待光标：初始加载显示三点脉动动画（● ● ●）
- 💫 输出时显示优雅的渐变竖线光标（|），更具科技感
- 🔄 自动滚动，始终跟随最新内容
- 📡 兼容 OpenAI、Ollama 等多种流式 API 格式

#### AI 数据增强
- 📊 给 AI 提供完整历史数据，不再局限于30天
- 📝 每日数据详细展示：日期、跑步时间、距离、时长、配速、力量训练、体感
- 📈 总览统计 + 详细表格，AI 分析更准确全面

#### 用户体验优化
- 🔄 新增重试功能：AI 报错时一键重试，无需重新输入
- 💬 清空对话弹窗美化，与删除记录弹窗样式统一
- 🐛 修复 Markdown 表格分隔符行（----）显示问题
- 📏 优化 AI 回复的段落、表格间距，显示更紧凑美观

#### 技术改进
- 🔧 新增 `callAIStreaming()` 函数，使用 ReadableStream API
- 🎨 新增流式消息处理：`appendAIStreamingMessage()`、`updateAIStreamingMessage()`、`finalizeAIStreamingMessage()`
- 💅 新增光标动画 CSS：三点脉动（dotPulse）和渐变竖线（cursor-bar）
- 🔍 改进 Markdown 解析：逐行处理，精确控制块级元素间距
- 📦 代码变更：+300 行

---

## v2.0.0

### 🤖 AI 运动助手（重大新功能）

#### 核心功能
- ✨ 全新 AI 助手页面，支持智能对话分析运动数据
- 📊 自动分析最近30天运动数据，提供数据摘要给 AI 作为上下文
- 💬 类似 ChatGPT 的聊天界面，流畅的对话体验
- 🎯 快速问题按钮：月度数据分析、训练计划制定、配速分析、改进建议
- 🔄 一键清空对话，重新开始新的对话

#### AI 配置管理
- ⚙️ 在设置页面配置 AI 参数：API URL、API Key、模型名称
- 💾 配置信息加密保存在本地 config.json
- 🔧 支持多种 AI 服务：
  - OpenAI (GPT-3.5, GPT-4)
  - Claude (Anthropic)
  - Ollama (本地免费部署)
  - 其他兼容 OpenAI API 的服务

#### Markdown 格式支持
- 📝 完整的 Markdown 格式渲染：
  - 标题（H1-H4）- 层级清晰，加粗显示
  - 列表（有序/无序）- 正确缩进，结构化展示
  - 代码块和行内代码 - 语法高亮，等宽字体
  - 表格 - 完整边框，数据对比清晰
  - 引用块 - 左侧颜色边框，斜体显示
  - 加粗、斜体、链接、水平线等
- 🎨 深色/浅色模式完美适配所有 Markdown 元素

#### 用户体验
- 💬 Enter 发送消息，Shift+Enter 换行
- ⌨️ 输入框自动调整高度（最大120px）
- 🔄 思考中动画（三个跳动的点）
- 📍 消息自动滚动到底部
- ⚡ 发送中状态（禁用按钮防止重复提交）
- ❌ 友好的错误提示，帮助用户排查问题

#### 数据隐私
- 🔒 只发送统计数据（总数、平均值），不发送详细体感记录
- 💾 API Key 加密保存在本地
- 🏠 支持 Ollama 本地部署，数据完全不上传

#### 技术实现
- 📝 新增代码约 800+ 行（HTML/CSS/JavaScript）
- 🎨 新增 380+ 行 CSS 样式（聊天界面 + Markdown）
- ⚙️ 新增 IPC 通信接口：get-ai-config, save-ai-config
- 🔧 增强 formatAIMessage 函数，支持完整 Markdown 解析

---

## v1.2.3

### 🎯 用户体验优化

#### 时长输入方式改进
- ⏱️ 跑步时长输入改为时间选择器（与跑步时间保持一致）
- 🎨 从文本框 `type="text"` 改为时间选择器 `type="time"`
- ✨ 支持精确到秒的时间选择（`step="1"`）
- 🖱️ 点击输入框自动弹出时间选择界面，操作更直观
- 🚀 提升用户输入效率，减少格式错误

#### 技术改进
- 🔧 更新 `timeToSeconds()` 函数以正确处理时间选择器格式
- 📝 支持 HH:MM 和 HH:MM:SS 两种时间格式
- ✅ 保持数据兼容性，不影响已有数据

#### 版本信息
- 📦 更新应用版本号为 1.2.3

---

## v1.2.2

### 🎨 深色模式侧边栏优化

#### 侧边栏颜色适配
- 🌙 深色模式下侧边栏不再保持亮色，改为基于主题颜色的深色变体
- 🎨 新增5种颜色的深色变体（紫色、蓝色、绿色、橙色、粉色）
- 🔄 浅色模式：明亮渐变色侧边栏 + 白色背景
- 🌃 深色模式：深色渐变侧边栏 + 深色背景（非纯黑，保持颜色特征）

#### 颜色映射
- 💜 紫色：`#667eea` → `#4a5bb8`（深色版）
- 💙 蓝色：`#3498db` → `#2574a9`（深色版）
- 💚 绿色：`#2ecc71` → `#229954`（深色版）
- 🧡 橙色：`#e67e22` → `#ba6516`（深色版）
- 💗 粉色：`#e91e63` → `#c2185b`（深色版）

#### 配置优化
- 📝 .gitignore 新增学习文档.md

#### 技术改进
- 🎨 CSS 新增：+35 行深色模式颜色变量
- 📦 代码变更：+37 行 / -1 行

---

## v1.2.1

### 🎨 界面优化与体验改进

#### 深色模式完善
- 🌙 优化深色模式下的界面元素颜色
- 📝 输入框背景改为深色（#1e1f20），不再刺眼
- 📋 卡片和容器背景统一为 #242526
- 📊 表格、图表、按钮等 15+ 种元素深色适配
- ✨ 新增 140+ 行深色模式专用样式

#### 图表展示优化
- 🎯 图表选择改为单选模式（之前为多选）
- 🔘 移除复选框，改用优雅的按钮设计
- ✅ 点击按钮只显示对应图表，界面更简洁
- 🎨 激活状态：渐变色背景 + 左侧指示条
- 📍 默认显示配速趋势图

#### Bug 修复
- 🐛 修复图表选择器中盾牌和跑步人图标不显示的问题
- 🎨 正确设置 SVG 图标的 fill 和 stroke 属性
- 🔍 添加 `icon-stroke-only` 类区分不同类型图标
- 🔧 修复统计页面图表无法显示的问题（更新图表渲染逻辑）

#### 文档优化
- 📝 重写 README.md 文档，内容更聚焦和实用
- 📋 将版本更新历史移至专门的 CHANGELOG.md
- ✨ 增强功能特性介绍，添加详细使用说明
- 📖 补充技术栈说明和数据格式示例

#### 技术改进
- 📦 代码变更：+232 行 / -92 行
- 🎨 CSS 优化：+243 行（含深色模式样式）
- 🔧 JavaScript 重构：图表选择逻辑更清晰
- 🏗️ HTML 结构：用按钮替换复选框

---

## v1.2.0

### 🎨 界面美化大更新

#### 新增功能

**1. 主题系统**
- ✨ 深色/浅色模式切换
- 🎨 5种主题颜色（紫色、蓝色、绿色、橙色、粉色）
- 💾 主题偏好自动保存

**2. 热力图日历**
- 📊 类似 GitHub 的运动数据可视化
- 📅 显示过去 364 天的运动记录
- 🎯 5级强度显示
- 🖱️ 交互式工具提示和点击跳转

**3. 表格功能增强**
- 🔍 智能搜索（日期、时间、体感记录）
- 🔢 多列排序（8个字段可排序）
- ⬆️ 排序图标实时反馈

**4. 空状态优化**
- 🎭 友好的无数据引导界面
- 🖼️ 精美的空状态插图
- 🚀 快速操作按钮

**5. 动画优化**
- ✨ 丝滑的页面切换效果
- 🎬 骨架屏加载动画
- 🌊 平滑的缓动曲线

#### 技术改进

- 📈 新增代码：1129 行（+1129 / -23）
- 🎨 CSS 变量系统支持主题切换
- 💾 localStorage 持久化用户偏好
- ⚡ 优化的动画性能
- ✅ 完全向后兼容

#### 文件变更

```
README.md                   | +54 行
package.json                | v1.1.1 → v1.2.0
src/renderer/css/styles.css | +574 行
src/renderer/index.html     | +156 行
src/renderer/js/app.js      | +366 行
```

---

## v1.1.1

### 代码优化与性能提升

- 主进程代码重构
- DOM 缓存机制
- CSS 变量系统
- 函数优化精简
- 代码行数减少约 15%

---

## v1.1.0

### 图表数据显示优化

- 智能数据过滤
- 图表数据处理逻辑优化

---

## v1.0.2

### 用户体验优化

- 图表自动滚动定位
- 历史记录表格美化

---

## v1.0.1

### Bug 修复

- 修复表单输入框失焦问题
- Toast 提示系统
- 自定义确认对话框
