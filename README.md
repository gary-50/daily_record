# 体育锻炼记录系统

基于 Electron 的桌面应用，用于记录和管理体育锻炼数据。

## 功能特点

- 记录跑步、力量训练等锻炼数据
- 可视化展示锻炼趋势和成果
- 查看和管理所有锻炼历史
- 数据本地存储，完全离线使用
- 自定义数据存储位置，方便备份和迁移

## 快速开始

### 安装依赖

```bash
npm install
```

### 运行应用

```bash
npm start
```

### 开发模式（带开发者工具）

```bash
npm run dev
```

## 项目结构

```
record_exercise/
├── src/                     # 源代码目录
│   ├── main/               # 主进程
│   │   ├── main.js         # Electron 主进程入口
│   │   └── preload.js      # IPC 通信桥接
│   └── renderer/           # 渲染进程
│       ├── index.html      # 应用界面
│       ├── css/
│       │   └── styles.css  # 样式文件
│       └── js/
│           └── app.js      # 前端逻辑
├── package.json            # 项目配置
└── README.md               # 项目文档
```

## 数据存储位置

### 默认存储位置

- **Windows**: `%APPDATA%\exercise-tracker-electron\exercise-data.json`
- **macOS**: `~/Library/Application Support/exercise-tracker-electron/exercise-data.json`
- **Linux**: `~/.config/exercise-tracker-electron/exercise-data.json`

### 自定义存储位置

从版本 1.0.0 开始，用户可以自定义数据文件的存储位置：

1. 打开应用，点击左侧菜单的"设置"
2. 在"数据存储位置"部分，点击"更改存储位置"按钮
3. 选择您想要保存数据文件的位置
4. 应用会自动将现有数据复制到新位置

**注意事项：**
- 更改存储位置后，原有数据会被自动复制到新位置
- 配置信息存储在默认的应用数据目录中
- 建议选择一个安全且方便备份的位置（如云同步文件夹）

## 打包发布

```bash
# 安装打包工具
npm install --save-dev electron-builder

# 打包应用
npm run dist
```

打包后的文件会在 `dist` 目录中。

## 技术栈

- Electron - 桌面应用框架
- Chart.js - 数据可视化
- JavaScript + CSS3

## 开发日志

### 版本 1.1.1 - 代码优化与性能提升

#### 主进程优化 (main.js)
1. **代码重构**
   - 抽取公共文件读写函数 `readJSONFile` 和 `writeJSONFile`
   - 简化 IPC 处理器逻辑，减少重复代码
   - 优化配置加载和数据文件管理流程
   - 改进错误处理的一致性

2. **性能提升**
   - 减少文件系统操作的冗余代码
   - 统一的文件操作接口提高可维护性

#### 渲染进程优化 (app.js)
1. **DOM 缓存机制**
   - 实现 `cacheDOMElements` 函数，缓存常用DOM元素引用
   - 避免重复的 `getElementById` 查询，提升DOM操作性能
   - 所有频繁访问的DOM元素统一管理在 `DOM` 对象中

2. **常量化配置**
   - 提取魔法数字为命名常量（如 `CHART_SCROLL_DELAY: 150`）
   - 集中管理延迟时间、动画时长等配置值
   - 提高代码可读性和可维护性

3. **代码精简**
   - 优化数据处理函数，使用箭头函数和数组方法
   - 简化条件判断和循环逻辑
   - 移除冗余的注释和重复代码
   - `updateStatCards` 使用 reduce 统一处理数据聚合
   - 使用对象映射管理图表实例，替代多个全局变量

4. **函数优化**
   - `timeToSeconds`: 使用解构赋值和 map 简化逻辑
   - `showToast`: 使用对象映射替代多个 if-else 分支
   - `displayRecords`: 简化排序和数据处理逻辑
   - `updateCharts`: 优化数据过滤条件表达式
   - `bindEventListeners`: 使用对象键遍历简化图表复选框绑定

#### 样式表优化 (styles.css)
1. **CSS 变量系统**
   - 引入 `:root` 作用域的 CSS 变量
   - 统一管理颜色方案、渐变、阴影、圆角等样式值
   - 20+ 个 CSS 变量覆盖主要样式属性

2. **变量分类**
   - 主题色：`--primary-color`, `--primary-gradient` 等
   - 文字色：`--text-primary`, `--text-secondary`, `--text-muted`
   - 背景色：`--bg-primary`, `--bg-secondary`, `--bg-white`
   - 边框色：`--border-color`, `--border-light`
   - 阴影：`--shadow-sm`, `--shadow-md`, `--shadow-lg`, `--shadow-primary`
   - 动画：`--transition-base`, `--transition-fast`
   - 圆角：`--radius-sm`, `--radius-md`, `--radius-lg`

3. **可维护性提升**
   - 统一的样式变量便于主题定制
   - 减少重复的样式声明
   - 全局样式调整只需修改变量值

#### 性能与体积
- **代码行数减少**：通过精简和优化减少约 15% 的代码行数
- **运行时性能**：DOM 缓存和优化的数据处理提升响应速度
- **内存使用**：统一的图表管理和事件监听优化内存占用
- **可维护性**：更清晰的代码结构和命名，降低维护成本

#### 技术改进
- 现代 ES6+ 语法：解构、箭头函数、对象简写
- 函数式编程：map、reduce、filter 等数组方法
- 单一职责原则：每个函数功能更聚焦
- DRY 原则：消除重复代码
- 代码可读性：简化复杂逻辑，提高表达力

**注意**：本次更新完全向后兼容，不影响任何现有功能，仅优化代码质量和性能。

### 版本 1.1.0 - 图表数据显示优化

#### 功能优化
1. **智能数据过滤**
   - 配速图表：当跑步距离或时长为0时，自动跳过该数据点
   - 力量训练图表：当俯卧撑、深蹲或登山跑数量为0时，自动跳过该数据点
   - 跑步距离图表：当跑步距离为0时，自动跳过该数据点
   - 图表只显示有实际运动数据的日期，提升可读性

#### 技术改进
2. **数据处理逻辑**
   - 修改 `updateStatCards` 函数，为0值返回null代替0
   - 所有图表数据系列添加 `spanGaps: true` 属性
   - 修正统计卡片的总计算逻辑，避免null值影响计算结果
   - 图表能够正确渲染不连续的数据点

### 版本 1.0.2 - 用户体验优化

#### 新增功能
1. **图表自动滚动定位**
   - 点击展示图表复选框时，页面自动平滑滚动到对应图表位置
   - 延迟 150ms 确保图表渲染完成后再滚动
   - 提升用户查看图表的便捷性

#### 界面美化
2. **历史记录表格优化**
   - 表头样式改为纯白色背景 + 深灰色文字，简洁大方
   - 表头支持滚动时固定在顶部（sticky 定位）
   - 优化鼠标悬停效果，移除缩放动画避免页面抖动
   - 使用柔和的渐变背景高亮悬停行
   - 整体更加优雅稳定

### 版本 1.0.1 - 重要 Bug 修复

#### 修复的核心问题

**问题描述：** 提交记录或删除记录后，表单输入框无法点击和输入，只有最小化窗口后重新打开才能恢复正常。

**根本原因：** Electron 中的 `alert()` 和 `confirm()` 是阻塞式模态对话框，会冻结主窗口交互并夺取键盘焦点。关闭对话框后，焦点可能无法正确返回到表单元素，导致输入失效。

**解决方案：**
1. **Toast 提示组件**：实现非阻塞式 Toast 提示，替换所有 `alert()` 调用
   - 位置：右上角滑入
   - 自动 3 秒消失
   - 支持成功、错误、信息三种类型
   - 不影响表单焦点和用户操作

2. **自定义确认对话框**：实现非阻塞式确认对话框，替换所有 `confirm()` 调用
   - 基于 Promise 的异步操作
   - 支持键盘操作（ESC 取消）
   - 不会冻结界面和键盘输入
   - 保持表单焦点状态

3. **图表显示优化**：修复折线图超出容器边框的问题
   - 移除固定高度，使用 Canvas 高度约束
   - 确保图表完全显示在容器内

**技术要点：**
- 所有提示和确认操作均为非阻塞式
- 使用 Promise/async-await 处理用户交互
- 保证表单元素焦点状态始终正确
- 提升用户体验，避免界面卡顿

## 许可证

ISC
